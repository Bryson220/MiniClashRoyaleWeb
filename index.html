<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Mini Clash Royale</title>
<style>
  body { margin: 0; overflow: hidden; font-family: sans-serif; }
  #game { position: relative; width: 1200px; height: 600px; margin: auto; background: #87ceeb; }
  .river { position: absolute; top: 275px; width: 1200px; height: 50px; background: #00bfff; }
  .tower { position: absolute; width: 80px; height: 120px; border-radius: 10px; color: #fff; font-weight: bold;
           display: flex; justify-content: center; align-items: center; text-align:center; }
  .player-tower { background: #4a90e2; left: 50px; top: 240px; }
  .ai-tower { background: #e24a4a; right: 50px; top: 240px; }
  .card { width: 60px; height: 60px; margin: 5px; cursor: grab; }
  #hand { position: absolute; bottom: 10px; left: 10px; display: flex; z-index: 10; }
  .unit { position: absolute; width: 40px; height: 40px; pointer-events: none; }
  .hp-bar { position: absolute; height: 5px; background: red; }
  .hp-fill { height: 5px; background: green; }
  #elixir { position: absolute; top: 10px; left: 10px; font-weight: bold; z-index:10;}
</style>
</head>
<body>

<div id="game">
  <div class="river"></div>
  <div class="tower player-tower" id="player-tower">5000</div>
  <div class="tower ai-tower" id="ai-tower">5000</div>
  <div id="hand"></div>
  <div id="elixir">Elixir: 10</div>
</div>

<script>
// ------------------- Game Constants -------------------
const MAP_WIDTH = 1200;
const MAP_HEIGHT = 600;
const TOWER_HP_MAX = 5000;
const ELIXIR_MAX = 10;
const ELIXIR_REGEN = 1;
const ATTACK_COOLDOWN = 1000;

// Card definitions
const CARD_DATA = [
  { id: "archer", name: "Archer", hp: 50, dmg: 10, speed: 1.5, range: 100, cost: 3, img: "https://via.placeholder.com/60x60?text=A" },
  { id: "giant", name: "Giant", hp: 200, dmg: 20, speed: 0.7, range: 30, cost: 5, img: "https://via.placeholder.com/60x60?text=G" },
  { id: "knight", name: "Knight", hp: 100, dmg: 15, speed: 1, range: 30, cost: 4, img: "https://via.placeholder.com/60x60?text=K" },
  { id: "minion", name: "Minion", hp: 30, dmg: 8, speed: 2, range: 50, cost: 2, img: "https://via.placeholder.com/60x60?text=M" }
];

// ------------------- Game State -------------------
let playerElixir = ELIXIR_MAX;
let playerUnits = [];
let aiUnits = [];
let lastUpdate = Date.now();
let towers = {
  player: { hp: TOWER_HP_MAX, x: 90, y: 240+60 },
  ai: { hp: TOWER_HP_MAX, x: MAP_WIDTH - 90, y: 240+60 }
};

// ------------------- Utility Functions -------------------
function clamp(value, min, max) { return Math.min(Math.max(value, min), max); }
function distance(a, b) { return Math.hypot(a.x - b.x, a.y - b.y); }

// ------------------- Game Elements -------------------
const gameDiv = document.getElementById("game");
const handDiv = document.getElementById("hand");
const elixirDiv = document.getElementById("elixir");
const playerTowerDiv = document.getElementById("player-tower");
const aiTowerDiv = document.getElementById("ai-tower");

// ------------------- Setup Player Hand -------------------
CARD_DATA.forEach(card => {
  const img = document.createElement("img");
  img.src = card.img;
  img.className = "card";
  img.draggable = true;
  img.title = `${card.name} (Cost: ${card.cost})`;
  img.addEventListener("dragstart", e => {
    if(playerElixir < card.cost) e.preventDefault();
    e.dataTransfer.setData("cardId", card.id);
  });
  handDiv.appendChild(img);
});

// ------------------- Drag & Drop -------------------
gameDiv.addEventListener("dragover", e => e.preventDefault());
gameDiv.addEventListener("drop", e => {
  e.preventDefault();
  const cardId = e.dataTransfer.getData("cardId");
  if(!cardId) return;
  const card = CARD_DATA.find(c => c.id === cardId);
  if(playerElixir < card.cost) return;
  const rect = gameDiv.getBoundingClientRect();
  const x = e.clientX - rect.left - 20;
  const y = e.clientY - rect.top - 20;
  if(y < MAP_HEIGHT/2) return; // can't place on opponent side
  spawnUnit("player", card, x, y);
  playerElixir -= card.cost;
  updateElixir();
});

// ------------------- Spawn Units -------------------
function spawnUnit(side, card, x, y) {
  const unitDiv = document.createElement("div");
  unitDiv.className = "unit";
  unitDiv.style.left = x + "px";
  unitDiv.style.top = y + "px";
  unitDiv.style.backgroundImage = `url(${card.img})`;
  unitDiv.style.backgroundSize = "cover";

  const hpBar = document.createElement("div");
  hpBar.className = "hp-bar";
  hpBar.style.left = x + "px";
  hpBar.style.top = (y-8) + "px";
  hpBar.style.width = "40px";
  const hpFill = document.createElement("div");
  hpFill.className = "hp-fill";
  hpFill.style.width = "100%";
  hpBar.appendChild(hpFill);

  const unit = { side, card, x, y, hp: card.hp, div: unitDiv, hpDiv: hpFill, target: null, lastAttack: 0 };
  gameDiv.appendChild(unitDiv);
  gameDiv.appendChild(hpBar);
  if(side === "player") playerUnits.push(unit);
  else aiUnits.push(unit);
}

// ------------------- Elixir Update -------------------
function updateElixir() { elixirDiv.textContent = `Elixir: ${Math.floor(playerElixir)}`; }

// ------------------- AI -------------------
function aiPlay() {
  const affordable = CARD_DATA.filter(c => c.cost <= ELIXIR_MAX);
  if(affordable.length === 0) return;
  const card = affordable[Math.floor(Math.random()*affordable.length)];
  const x = MAP_WIDTH - 150;
  const y = MAP_HEIGHT/2 - 50 + Math.random()*100;
  spawnUnit("ai", card, x, y);
}

// ------------------- Game Loop -------------------
function gameLoop() {
  const now = Date.now();
  const delta = (now - lastUpdate)/1000;
  lastUpdate = now;

  // Elixir regen
  playerElixir = clamp(playerElixir + ELIXIR_REGEN*delta, 0, ELIXIR_MAX);
  updateElixir();

  // Function to update units
  function updateUnits(units, enemies, enemyTower, isPlayer){
    units.forEach(unit => {
      if(unit.hp <= 0) return;

      // Target closest enemy unit
      let closest = null;
      let distClosest = Infinity;
      enemies.forEach(e => {
        const d = distance(unit, e);
        if(d < distClosest){ distClosest=d; closest=e; }
      });

      // Compare distance to tower
      const dTower = distance(unit, enemyTower);
      if(!closest || dTower < distClosest) closest = {x: enemyTower.x, y: enemyTower.y, isTower:true};

      unit.target = closest;

      // Move or attack
      const dx = closest.x - unit.x;
      const dy = closest.y - unit.y;
      const dist = Math.hypot(dx,dy);
      if(dist > unit.card.range){
        unit.x += dx/dist*unit.card.speed*2;
        unit.y += dy/dist*unit.card.speed*2;
      } else {
        if(now - unit.lastAttack > ATTACK_COOLDOWN){
          unit.lastAttack = now;
          if(closest.isTower){
            if(isPlayer) towers.ai.hp -= unit.card.dmg;
            else towers.player.hp -= unit.card.dmg;
          } else {
            closest.hp -= unit.card.dmg;
          }
        }
      }

      // Update visuals
      unit.div.style.left = unit.x + "px";
      unit.div.style.top = unit.y + "px";
      if(unit.hpDiv) unit.hpDiv.style.width = (unit.hp/unit.card.hp*100) + "%";
    });

    // Remove dead units
    for(let i=units.length-1;i>=0;i--){
      if(units[i].hp <= 0){
        gameDiv.removeChild(units[i].div);
        if(units[i].hpDiv && units[i].hpDiv.parentElement) units[i].hpDiv.parentElement.remove();
        units.splice(i,1);
      }
    }
  }

  updateUnits(playerUnits, aiUnits, towers.ai, true);
  updateUnits(aiUnits, playerUnits, towers.player, false);

  // Update tower HP visuals
  playerTowerDiv.textContent = Math.max(0,towers.player.hp);
  aiTowerDiv.textContent = Math.max(0,towers.ai.hp);

  // AI random spawn
  if(Math.random()<0.01) aiPlay();

  requestAnimationFrame(gameLoop);
}

// ------------------- Start -------------------
updateElixir();
gameLoop();

</script>
</body>
</html>
