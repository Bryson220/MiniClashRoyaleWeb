<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mini Clash Royale</title>
<style>
body { margin:0; background-color:#87CEEB; font-family:Arial, sans-serif; user-select:none; overflow:hidden; }
#gameArea { position: relative; width: 600px; height: 800px; margin: auto; background-color: #7CFC00; border:2px solid #000; }
.tower, .unit { position: absolute; display:flex; justify-content:center; align-items:center; }
.tower img, .unit img { width:60px; height:60px; }
.hpBar { position:absolute; top:-6px; left:0; height:6px; width:100%; background-color:green; border:1px solid #000; }
#elixirBar { position:absolute; bottom:0; left:50%; transform:translateX(-50%); font-weight:bold; font-size:16px; background: rgba(0,0,0,0.5); color:#fff; padding:5px 10px; border-radius:5px; }
#cards { position:absolute; bottom:50px; left:50%; transform:translateX(-50%); display:flex; }
.card { width:60px; height:60px; margin:5px; border:2px solid black; border-radius:5px; background-color:#fff; display:flex; justify-content:center; align-items:center; cursor:grab; font-weight:bold; }
</style>
</head>
<body>
<div id="gameArea"></div>
<div id="elixirBar">Elixir: 10</div>
<div id="cards"></div>

<script>
// Constants
const GAME_WIDTH = 600;
const GAME_HEIGHT = 800;
const BRIDGE_LEFT_X = 150;
const BRIDGE_RIGHT_X = 450;
const MAX_ELIXIR = 10;
const ELIXIR_REGEN = 1;
const AI_PLAY_INTERVAL = 3000;

// Elements
const gameArea = document.getElementById('gameArea');
const elixirBar = document.getElementById('elixirBar');
const cardsDiv = document.getElementById('cards');

// Player & AI
let playerElixir = MAX_ELIXIR;
let aiElixir = MAX_ELIXIR;
let playerUnits = [];
let aiUnits = [];

// Cards
const cardsData = [
  {name:'Knight', cost:3, hp:200, dmg:20, speed:1.2, range:30, type:'melee', img:'images/knight.png'},
  {name:'Archer', cost:3, hp:100, dmg:15, speed:1.5, range:80, type:'ranged', img:'images/archer.png'},
  {name:'Giant', cost:5, hp:500, dmg:30, speed:0.7, range:30, type:'giant', img:'images/giant.png'}
];

// Towers
let towers = {
  playerKing: {x: GAME_WIDTH/2-30, y: GAME_HEIGHT-100, hp:5000, img:'images/king-tower.png', element:null},
  aiKing: {x: GAME_WIDTH/2-30, y: 20, hp:5000, img:'images/king-tower.png', element:null},
  playerLeft: {x: GAME_WIDTH/2-150, y: GAME_HEIGHT-160, hp:2000, img:'images/princess-tower.png', element:null},
  playerRight: {x: GAME_WIDTH/2+70, y: GAME_HEIGHT-160, hp:2000, img:'images/princess-tower.png', element:null},
  aiLeft: {x: GAME_WIDTH/2-150, y: 100, hp:2000, img:'images/princess-tower.png', element:null},
  aiRight: {x: GAME_WIDTH/2+70, y: 100, hp:2000, img:'images/princess-tower.png', element:null}
};

// Create tower elements
function createTower(tower){
  const div=document.createElement('div');
  div.className='tower';
  div.style.left=tower.x+'px';
  div.style.top=tower.y+'px';
  const img=document.createElement('img');
  img.src=tower.img;
  div.appendChild(img);
  const hp=document.createElement('div');
  hp.className='hpBar';
  div.appendChild(hp);
  gameArea.appendChild(div);
  tower.element=div;
}
for(const t in towers) createTower(towers[t]);

// Create card buttons
function createCardButton(card){
  const div=document.createElement('div');
  div.className='card';
  const img=document.createElement('img');
  img.src=card.img;
  img.style.width='50px';
  img.style.height='50px';
  div.appendChild(img);
  div.draggable=true;
  div.addEventListener('dragstart',(e)=>dragStart(e,card));
  cardsDiv.appendChild(div);
}
cardsData.forEach(createCardButton);

// Drag & Drop
let draggingCard = null;
function dragStart(e,card){draggingCard=card;}
gameArea.addEventListener('dragover',e=>e.preventDefault());
gameArea.addEventListener('drop',e=>{
  e.preventDefault();
  if(!draggingCard || playerElixir<draggingCard.cost) return;
  const rect=gameArea.getBoundingClientRect();
  const x=e.clientX-rect.left;
  const y=e.clientY-rect.top;
  if(y>GAME_HEIGHT/2) spawnUnit('player',draggingCard,{x,y});
  draggingCard=null;
});

// Spawn units
function spawnUnit(side,card,pos){
  const unit={
    id:Math.random().toString(36).substr(2,9),
    x:pos.x, y:pos.y,
    card, hp:card.hp, side, target:null
  };
  const div=document.createElement('div');
  div.className='unit';
  const img=document.createElement('img');
  img.src=card.img;
  div.appendChild(img);
  const hp=document.createElement('div');
  hp.className='hpBar';
  div.appendChild(hp);
  gameArea.appendChild(div);
  unit.element=div;
  if(side==='player') playerUnits.push(unit), playerElixir-=card.cost;
  else aiUnits.push(unit), aiElixir-=card.cost;
}

// Elixir bar
function updateElixir(){elixirBar.innerText=`Elixir: ${playerElixir}`;}

// Distance
function distance(a,b){return Math.hypot(a.x-b.x,a.y-b.y);}

// Find target
function findTarget(unit,enemyUnits,enemyTowers){
  if(unit.card.type==='giant'){
    return unit.side==='player'?towers.aiKing:towers.playerKing;
  }
  let closest=null,dist=Infinity;
  enemyUnits.forEach(u=>{
    const d=distance(unit,u);
    if(d<dist){closest=u; dist=d;}
  });
  if(closest) return closest;
  return unit.side==='player'?towers.aiKing:towers.playerKing;
}

// Update units
function updateUnits(units,enemyUnits,enemyTowers){
  units.forEach(u=>{
    if(u.hp<=0){u.element.remove(); return;}
    let target=findTarget(u,enemyUnits,enemyTowers);
    const dist=distance(u,target);
    if(dist<u.card.range){
      target.hp-=u.card.dmg*0.05;
      if(target.element){
        const maxHP=target===towers.playerKing||target===towers.aiKing?5000:2000;
        target.element.querySelector('.hpBar').style.width=(target.hp/maxHP*100)+'%';
      }
    } else {
      const dx=target.x-u.x, dy=target.y-u.y, d=Math.hypot(dx,dy);
      u.x+=dx/d*u.card.speed;
      u.y+=dy/d*u.card.speed;
    }
    u.element.style.left=u.x+'px';
    u.element.style.top=u.y+'px';
  });
  for(let i=units.length-1;i>=0;i--) if(units[i].hp<=0) units.splice(i,1);
}

// AI play
function aiPlay(){
  if(aiElixir>=3){
    const card=cardsData[Math.floor(Math.random()*cardsData.length)];
    const x=Math.random()<0.5?BRIDGE_LEFT_X:BRIDGE_RIGHT_X;
    const y=100;
    spawnUnit('ai',card,{x,y});
  }
}

// Game loops
setInterval(()=>{
  playerElixir=Math.min(playerElixir+1,MAX_ELIXIR);
  aiElixir=Math.min(aiElixir+1,MAX_ELIXIR);
  updateElixir();
},2800);
setInterval(aiPlay,AI_PLAY_INTERVAL);
function gameLoop(){
  updateUnits(playerUnits,aiUnits,towers);
  updateUnits(aiUnits,playerUnits,towers);
  requestAnimationFrame(gameLoop);
}
gameLoop();
</script>
</body>
</html>
