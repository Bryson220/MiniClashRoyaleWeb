<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Clash Royale Arena Replica</title>
<style>
  html, body { margin:0; padding:0; background:#000; height:100%; overflow:hidden; }
  #gameWrap { display:flex; align-items:center; justify-content:center; height:100vh; }
  canvas { border-radius:10px; box-shadow:0 6px 20px rgba(0,0,0,0.3); display:block; }
  #ui {
    position:absolute; bottom:16px; left:50%; transform:translateX(-50%);
    display:flex; gap:12px; pointer-events:none;
  }
  .card-slot {
    width:80px; height:100px; background:#fff; border-radius:8px;
    display:flex; flex-direction:column; align-items:center; justify-content:center;
    font-family:sans-serif; cursor:pointer; pointer-events:auto;
    transition: transform 0.15s ease;
  }
  .card-slot.selected { outline:3px solid #4caf50; transform:translateY(-4px); }
  #elixir {
    position:absolute; bottom:140px; left:50%; transform:translateX(-50%);
    width:200px; height:32px; background:rgba(0,0,0,0.1); border-radius:8px; overflow:hidden;
  }
  #elixirBar { height:100%; background:linear-gradient(#2eb8ff,#006fbd); width:0%; transition:width 0.25s linear; }
  #elixirVal {
    position:absolute; top:-20px; left:50%; transform:translateX(-50%);
    font-weight:bold; color:white; font-family:sans-serif;
  }
</style>
</head>
<body>
<div id="gameWrap">
  <canvas id="gameCanvas" width="540" height="960"></canvas>
</div>

<div id="elixir"><div id="elixirBar"></div><div id="elixirVal">0</div></div>

<div id="ui"></div>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const width = canvas.width;
const height = canvas.height;

// ---- Load Images ----
const images = {};
const imageSources = {
  arena: 'arenaGrass.png',   // Full arena texture
  river: 'river.png',
  bridge: 'bridge.png',
  towerPlayer: 'towerPlayer.png',
  towerEnemy: 'towerEnemy.png'
};

let loadedImages = 0;
const totalImages = Object.keys(imageSources).length;

for (const key in imageSources) {
  images[key] = new Image();
  images[key].src = imageSources[key];
  images[key].onload = () => { loadedImages++; if (loadedImages===totalImages) initGame(); };
}

// ---- Arena Configuration ----
const arena = { x:0, y:0, w:width, h:height };
const riverY = height/2 - 60;
const bridgeW = 100;
const bridgeH = 120;

// ---- Towers ----
const towers = [
  { img: 'towerEnemy', x: width/4 - 36, y: 80, team:'enemy', hp:300, w:72, h:72 },
  { img: 'towerEnemy', x: width*3/4 - 36, y: 80, team:'enemy', hp:300, w:72, h:72 },
  { img: 'towerPlayer', x: width/4 - 36, y: height - 160, team:'player', hp:300, w:72, h:72 },
  { img: 'towerPlayer', x: width*3/4 - 36, y: height - 160, team:'player', hp:300, w:72, h:72 }
];

// ---- Units ----
const units = [];
const cardDefs = [
  {id:'knight',name:'Knight',cost:3,hp:120,dmg:12,speed:60,size:18},
  {id:'archer',name:'Archer',cost:2,hp:70,dmg:10,speed:80,size:16},
  {id:'giant',name:'Giant',cost:5,hp:300,dmg:20,speed:40,size:28}
];

let elixir = 5;
const elixirMax = 10;
let lastElixirTick = performance.now();
let selectedCardIndex = null;

// ---- Draw Functions ----
function drawArena() {
  ctx.drawImage(images.arena, 0, 0, width, height);
  ctx.drawImage(images.river, 0, riverY, width, bridgeH);
  ctx.drawImage(images.bridge, width/4 - bridgeW/2, riverY, bridgeW, bridgeH);
  ctx.drawImage(images.bridge, width*3/4 - bridgeW/2, riverY, bridgeW, bridgeH);
}

function drawTowers() {
  for (const t of towers) {
    ctx.drawImage(images[t.img], t.x, t.y, t.w, t.h);
    ctx.fillStyle='rgba(0,0,0,0.3)';
    ctx.fillRect(t.x, t.y-12, t.w*(t.hp/300),6);
  }
}

function drawUnits() {
  for (const u of units) {
    ctx.beginPath();
    ctx.arc(u.x,u.y,u.size,0,Math.PI*2);
    ctx.fillStyle = u.team==='player'?'#2b9f49':'#d64545';
    ctx.fill();
  }
}

function draw() {
  drawArena();
  drawTowers();
  drawUnits();
}

// ---- Game Loop ----
function gameLoop(now){
  const dt=(now - lastElixirTick)/1000;

  // Regenerate Elixir
  if (now - lastElixirTick > 2800) {
    elixir = Math.min(elixirMax, elixir + 1);
    document.getElementById('elixirBar').style.width=(elixir/elixirMax*100)+'%';
    document.getElementById('elixirVal').textContent=Math.floor(elixir);
    lastElixirTick=now;
  }

  // Update Units
  for (let i=units.length-1;i>=0;i--){
    const u=units[i];
    // Move toward nearest target
    let target = towers.filter(t => t.team!==u.team)[0];
    if(target){
      const dx = target.x + target.w/2 - u.x;
      const dy = target.y + target.h/2 - u.y;
      const dist = Math.hypot(dx,dy);
      if(dist>1){
        u.x += dx/dist * u.speed*dt;
        u.y += dy/dist * u.speed*dt;
      }
    }
  }

  ctx.clearRect(0,0,width,height);
  draw();
  requestAnimationFrame(gameLoop);
}

// ---- Mouse / Card Placement ----
const canvasRect = canvas.getBoundingClientRect();
canvas.addEventListener('click', e => {
  if(selectedCardIndex===null) return;
  const rect=canvas.getBoundingClientRect();
  const x=(e.clientX-rect.left)*(canvas.width/rect.width);
  const y=(e.clientY-rect.top)*(canvas.height/rect.height);
  const card = cardDefs[selectedCardIndex];
  if(elixir<card.cost) return;
  elixir -= card.cost;
  document.getElementById('elixirBar').style.width=(elixir/elixirMax*100)+'%';
  document.getElementById('elixirVal').textContent=Math.floor(elixir);
  units.push({ x, y, team:'player', size:card.size, hp:card.hp, dmg:card.dmg, speed:card.speed });
  selectedCardIndex = null;
});

// ---- Build Card UI ----
const uiDiv = document.getElementById('ui');
cardDefs.forEach((c,i)=>{
  const slot = document.createElement('div');
  slot.className='card-slot';
  slot.textContent=c.name;
  slot.addEventListener('click', ()=>{ selectedCardIndex=i; });
  uiDiv.appendChild(slot);
});

// ---- Init ----
function initGame() { requestAnimationFrame(gameLoop); }

</script>
</body>
</html>
